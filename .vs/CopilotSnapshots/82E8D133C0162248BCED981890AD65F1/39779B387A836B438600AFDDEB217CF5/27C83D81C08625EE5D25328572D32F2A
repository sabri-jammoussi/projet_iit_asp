using Back.Data.Infrastructure.EF.Models;
using Microsoft.Data.SqlClient;
using Microsoft.EntityFrameworkCore;
using Microsoft.Extensions.Configuration;
using Microsoft.Extensions.Logging;

namespace Back.Data.Infrastructure.EF;

public class OltpDbContext : DbContext
{
	private readonly DbContextOptions<OltpDbContext> _options;
	private readonly IConfiguration _configuration;
	private readonly ILogger<OltpDbContext> _logger;

    public OltpDbContext(DbContextOptions<OltpDbContext> options, IConfiguration configuration, ILogger<OltpDbContext> logger)
    {
        _options = options;
        _configuration = configuration;
        _logger = logger;
    }

    protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)
	{
		var conn = new SqlConnectionStringBuilder(_configuration.GetConnectionString("UsersConnections"));

		_ = optionsBuilder
			.UseLazyLoadingProxies()
			.UseSqlServer(conn.ToString(), o => o.UseCompatibilityLevel(120));

		base.OnConfiguring(optionsBuilder);
	}

	public DbSet<AccountDao> Accounts { get; set; }

}
